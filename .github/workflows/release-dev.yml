name: 'Stencil Store Dev Release'

on:
  workflow_call:

permissions:
  contents: read
  id-token: write

jobs:
  build_stencil_store:
    name: ðŸ—ï¸ Build Stencil Store
    uses: ./.github/workflows/build.yml

  get_dev_version:
    name: ðŸ” Get Dev Build Version
    runs-on: ubuntu-latest
    needs: build_stencil_store
    outputs:
      dev-version: ${{ steps.generate-dev-version.outputs.DEV_VERSION }}
    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

      - name: âš™ï¸ Generate Dev Version
        id: generate-dev-version
        run: |
          PKG_JSON_VERSION=$(cat package.json | jq -r '.version')
          GIT_HASH=$(git rev-parse --short HEAD)
          DEV_VERSION=$PKG_JSON_VERSION-dev.$(date +"%s").$GIT_HASH
          echo "DEV_VERSION=$DEV_VERSION" >> $GITHUB_OUTPUT
        shell: bash

  publish_dev:
    name: ðŸš€ Publish Dev Build
    needs: get_dev_version
    uses: ./.github/workflows/publish-npm.yml
    with:
      tag: dev
      version: ${{ needs.get_dev_version.outputs.dev-version }}

